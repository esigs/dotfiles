# Flake-based NixOS Config

## Structure

```text
.
├── flake.nix                  # Main flake config
├── flake.lock                 # Pin versions of dependencies
├── home.nix                   # Home-manager configuration
├── hosts/
│   └── x1/
│       ├── configuration.nix          # x1's system config
│       └── hardware-configuration.nix # generated by nixos-generate-config
```

## Rebuilding System

To apply system changes for the x1 host:

```bash
sudo nixos-rebuild switch --flake .#x1
```

If you're setting this up on a new machine:

- Clone this repo.
- Make a new entry in flake.nix under nixosConfigurations.
- Add a `configuration.nix` and `hardware-configuration.nix` in hosts/<hostname>/.
    - You will want to copy from the new machine. This is the only heavy lifting.

Run the rebuild command above with the new host name.

## Key Concepts

- flake.nix: Central entry point. Defines all host machines.
- home.nix: Shared home-manager config imported per host.
- username is passed explicitly as a module argument (see userModule in flake.nix).
- userModule: Injects username as an argument so you can reuse the config across systems.
